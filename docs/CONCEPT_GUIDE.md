# Browsecomp-V3 核心概念科普指南

> 一文读懂：推理链模板、30条规则、约束，三者到底是什么关系？

---

## 写在前面

刚接触 Browsecomp-V3 时，你可能会被三个名词绕晕：

- **推理链模板**（7个）
- **30条规则**
- **约束**

它们看起来都像是"规则"，到底有什么区别？本文用通俗的语言和比喻帮你彻底理清。

---

## 一句话总结

| 概念 | 一句话解释 |
|------|-----------|
| **推理链模板** | **地图上的路线**（从A点到B点怎么走） |
| **30条规则** | **导航系统的匹配规则**（这条路线支持什么功能） |
| **约束** | **路上的检查站**（具体检查什么条件） |

---

## 概念一：推理链模板（7个模板）

### 是什么？

想象你在一个城市的**地铁线路图**上，有7条固定的地铁线路（A线、B线、C线...）。每条线路都有固定的站点和走向。

Browsecomp-V3 的**推理链模板**就是这7条"地铁线路"：

```
模板A（论文-作者-机构线）
    Paper(论文站) → HAS_AUTHOR(作者通道) → Author(作者站) → AFFILIATED_WITH(机构通道) → Institution(机构站)

模板B（作者-教育-获奖线）
    Author → EDUCATED_AT → Education → AWARDED → Awards

模板C（论文引用线）
    Paper → CITES → Paper → CITES → Paper

模板D（合作网络线）
    Paper → HAS_AUTHOR → Author → COAUTHORS → Author

模板E（会议参与线）
    Author → PRESENTED_AT → Event

模板F（技术内容线）
    Paper → MENTIONS → Concept

模板G（致谢关系线）
    Paper → ACKNOWLEDGES → Institution
```

### 关键特点

- **固定路径**：模板只规定"从哪出发，经过哪，到哪结束"
- **不涉及条件**：模板本身不说"要找2022年的论文"，只说"从论文出发，找作者，再找机构"

### 代码在哪里？

```
browsecomp_v3/templates/data/reasoning_chain_templates.json
```

---

## 概念二：30条规则（约束映射规则）

### 是什么？

现在你知道有7条地铁线路了。但问题是：**我能带什么物品上车？**

30条规则就像地铁系统的**安检规定表**，告诉你：

```
时间检查规则 → 适用于：A线、C线、E线（因为这些线路经过"论文站"，论文有发表时间）
作者名检查规则 → 适用于：A线、B线、D线（因为这些线路经过"作者站"）
合作者检查规则 → 仅适用于：A线（只有A线的结构能支撑"找合作者"的复杂查询）
```

### 为什么是30条？

因为系统设计了30种不同的"检查项目"，每种检查项目对应一条规则：

| 规则编号 | 规则名称 | 检查什么 | 适用于哪些模板 |
|---------|---------|---------|--------------|
| 1 | temporal | 发表年份 | A, C, E |
| 2 | author_count | 作者数量 | A, C |
| 3 | person_name | 作者姓名 | A, B, D |
| 4 | institution_affiliation | 机构名称 | A, B |
| 5 | citation_count | 引用数量 | C |
| ... | ... | ... | ... |

### 关键特点

- **适配关系**：解决"这个约束能不能在这条线路上用"的问题
- **静态配置**：规则是写死的，不会变

### 代码在哪里？

```
config/constraint_to_graph_mapping.json
```

---

## 概念三：约束（具体的筛选条件）

### 是什么？

好，现在你知道：
- 有7条地铁线路（模板）
- 每条线路支持哪些检查项目（规则）

**约束**就是实际执行时**具体的检查标准**。

比如"时间检查规则"在具体执行时会变成：

```
约束实例1: "找2022年发表的论文"  ← 从知识图谱中真实采样得到
约束实例2: "找2021年发表的论文"  ← 每次生成都不同
约束实例3: "找2023年发表的论文"  ← 随机采样
```

### 约束从哪来？

不是人工写的，而是**从知识图谱中实时采样**！

```python
# 伪代码示意
所有论文 = 从知识图谱获取全部论文()
所有年份 = 提取年份(所有论文)  # [2020, 2021, 2022, 2023, 2024]

约束值 = 随机选择(所有年份)  # 比如选中了 2022

生成的约束: {"publication_year": {"=": 2022}}
```

这就是为什么 Browsecomp-V3 生成的问题**保证有答案**——因为约束值来自真实数据！

### 关键特点

- **动态生成**：每次生成都从KG采样，值不同
- **真实有效**：因为来自真实数据，所以一定有匹配的实体

### 代码在哪里？

```
browsecomp_v3/constraints/constraint_generator.py
browsecomp_v3/constraints/value_generator.py
```

---

## 三者的完整协作流程

用一个实际例子，看看三者如何配合生成一个问题：

### Step 1: 选模板（选地铁线路）

```
系统随机选中：模板A（论文-作者-机构线）
```

### Step 2: 查规则（看这条线支持什么检查）

```
查表得知，模板A支持以下约束类型：
- temporal（发表年份）✓
- author_count（作者数量）✓
- person_name（作者姓名）✓
- institution_affiliation（机构名称）✓
- coauthor（合作者关系）✓
```

### Step 3: 选约束（随机挑几个检查项目）

```
系统随机选中3个约束：
1. temporal
2. person_name
3. author_count
```

### Step 4: 实例化（给检查项目赋具体值）

```
从知识图谱采样真实值：

1. temporal → {"=": 2022}  （KG中有2022年发表的论文）
2. person_name → "Kejun Bu" （KG中有叫Kejun Bu的作者）
3. author_count → {"=": 14} （KG中有14位作者的论文）
```

### Step 5: 执行查询（开着车过检查站）

```
起点：全部52篇论文

第1关（年份检查）：只留2022年的 → 剩5篇
第2关（作者检查）：只留Kejun Bu参与的 → 剩2篇
第3关（数量检查）：只留恰好14位作者的 → 剩1篇 ✓

答案确定了！
```

### Step 6: 生成问题

```
"2022年发表的、Kejun Bu参与的、恰好14位作者的论文标题是什么？"

答案："Nested order-disorder framework containing..."
```

---

## 关系图：一张图看清三者关系

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Browsecomp-V3 生成流程                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌──────────────┐                                                          │
│   │  推理链模板   │  ← 7条固定路线（A-G）                                      │
│   │  (7个)       │                                                          │
│   └──────┬───────┘                                                          │
│          │                                                                  │
│          │ 选择：模板A（论文-作者-机构）                                       │
│          ▼                                                                  │
│   ┌──────────────┐                                                          │
│   │   30条规则   │  ← 查表：模板A支持哪些约束？                                │
│   │  (映射关系)  │                                                          │
│   └──────┬───────┘                                                          │
│          │                                                                  │
│          │ 查询：支持 temporal, person_name, author_count...                  │
│          ▼                                                                  │
│   ┌──────────────┐                                                          │
│   │    约束      │  ← 从KG采样具体值                                          │
│   │  (动态生成)  │                                                          │
│   └──────┬───────┘                                                          │
│          │                                                                  │
│          │ 采样：year=2022, author="Kejun Bu", count=14                      │
│          ▼                                                                  │
│   ┌──────────────┐                                                          │
│   │   漏斗筛选   │  ← 逐步过滤候选集                                          │
│   │  (图遍历)    │                                                          │
│   └──────┬───────┘                                                          │
│          │                                                                  │
│          │ 52篇 → 5篇 → 2篇 → 1篇                                           │
│          ▼                                                                  │
│   ┌──────────────┐                                                          │
│   │    问题      │  ← 生成自然语言问题                                        │
│   └──────────────┘                                                          │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 常见误区澄清

### 误区1："30条规则就是30种约束"

❌ **错误理解**：30条规则 = 30个约束实例

✅ **正确理解**：30条规则 = 30种约束**类型**的定义，每种类型可以生成无数个具体约束实例

```
规则：temporal（时间约束类型）
      ↓ 可以生成
约束实例1: year=2020
约束实例2: year=2021
约束实例3: year=2022
...无数个
```

### 误区2："模板和约束是一一对应的"

❌ **错误理解**：模板A只能用约束X，模板B只能用约束Y

✅ **正确理解**：一个模板**支持多个约束**，一个约束也**适用于多个模板**

```
模板A ←→ [temporal, person_name, author_count, institution_affiliation...]
模板B ←→ [person_name, institution_affiliation, education_degree...]

temporal 只适用于 [A, C, E]
person_name 适用于 [A, B, D, F]
```

### 误区3："约束是人工写死的"

❌ **错误理解**：约束条件像配置文件一样写死在代码里

✅ **正确理解**：约束值**每次生成都从知识图谱实时采样**，所以值是变化的、真实的

```
第一次生成：year=2022, author="Kejun Bu"
第二次生成：year=2021, author="John Smith"
第三次生成：year=2023, author="Jane Doe"
...
```

---

## 记忆口诀

| 概念 | 记忆口诀 | 类比 |
|------|---------|------|
| **推理链模板** | "走哪条路" | 地铁线路图 |
| **30条规则** | "谁能走这条路" | 安检规定表 |
| **约束** | "路上设什么卡" | 具体的检查站 |

---

## 快速自检

读完本文后，看看你能不能回答：

1. **模板A和模板B的区别是什么？**
   <details><summary>答案</summary>路径不同：A是论文→作者→机构，B是作者→教育→获奖</details>

2. **为什么有的约束不能用在某些模板上？**
   <details><summary>答案</summary>因为模板路径上不包含该约束需要的节点类型（如"引用数量约束"需要Paper节点，模板B没有Paper节点）</details>

3. **同一个约束类型，为什么每次生成的值不一样？**
   <details><summary>答案</summary>因为约束值是从知识图谱中随机采样的，不是写死的</details>

---

## 相关文档

- `PROJECT_MEMORY.md` - 项目整体概览
- `GENERATION_MECHANISM_ANALYSIS.md` - 生成机制深度分析
- `CONSTRAINT_TYPES_ANALYSIS.md` - 约束类型详细分析
- `30_CONSTRAINTS_ACTIVATION_REPORT.md` - 30条约束启用状态

---

**最后更新**: 2026-02-04

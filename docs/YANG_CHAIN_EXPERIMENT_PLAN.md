# 杨逸飞推理链方案小规模试验计划

**分支**: `experiment/yang-yifei-chain`
**目标**: 验证"论文引用链+描述实体"生成问题的可行性
**规模**: 3-4个论文节点（简化版）
**预期周期**: 2-3天

---

## 一、试验目标

### 1.1 核心问题验证

| 问题 | 验证方式 | 成功标准 |
|------|---------|---------|
| 能否通过引用边构建论文链？ | 实现论文→论文→论文的串联 | 3篇论文通过CITES边连通 |
| 描述实体能否让问题可解？ | 用作者/年份/机构描述论文 | 问题有唯一答案 |
| 是否比V3模板方式更好？ | 对比问题质量和多样性 | 问题更复杂、更自然 |

### 1.2 具体目标

- [ ] 构建3篇论文的引用链
- [ ] 每篇论文提取2-3个描述实体
- [ ] 生成5-10个测试问题
- [ ] 问题有唯一答案
- [ ] 文档记录试验过程和结论

---

## 二、方案设计

### 2.1 核心概念映射

```
杨逸飞完整方案          本试验简化版
─────────────────────────────────────────
10个论文节点     →     3个论文节点
5个实体/节点     →     2-3个实体/节点
引用段落理解     →     不使用段落（简化）
回退机制         →     无（小规模不需要）
循环模板         →     线性链（简化）
```

### 2.2 数据结构

```python
# 论文链节点
PaperNode = {
    "paper_id": "paper_123",
    "title": "论文标题",
    "connected_entities": [
        {"type": "Author", "name": "Kejun Bu"},
        {"type": "Year", "value": 2022},
        {"type": "Institution", "name": "MIT"}
    ]
}

# 论文链
PaperChain = [
    Paper1,  # 起始论文
    Paper2,  # 被Paper1引用
    Paper3   # 被Paper2引用
]
```

### 2.3 问题生成策略

**策略1: 前向推理**
```
描述Paper1 → 问Paper1引用了哪篇论文 → 答案: Paper2

示例:
"2022年Kejun Bu在MIT发表的论文引用了哪篇关于神经网络的论文？"
→ 答案: Paper2的标题
```

**策略2: 后向推理**
```
描述Paper2 → 问哪篇论文引用了它 → 答案: Paper1

示例:
"哪篇2021年发表的论文引用了这篇关于深度学习的Nature文章？"
→ 答案: Paper1的标题
```

**策略3: 跳跃推理**
```
描述Paper1 + 描述Paper3 → 问中间论文

示例:
"2022年Kejun Bu的论文引用了某篇论文，该论文又被2023年John Smith的论文引用。中间这篇论文的标题是？"
→ 答案: Paper2的标题
```

---

## 三、实施步骤

### Step 1: 数据准备（半天）

**任务1.1**: 分析知识图谱中的引用关系
```bash
# 统计
- 有多少篇论文有引用关系？
- 引用链最长有多少篇？
- 哪些论文的相连实体丰富？
```

**任务1.2**: 手动选择3篇论文作为测试集
```
选择标准:
✓ 有引用关系: Paper1 → Paper2 → Paper3
✓ 实体丰富: 每篇论文有作者、年份、机构等信息
✓ 真实存在: 确保数据在KG中完整
```

**输出**: `data/yang_chain_test_set.json`

---

### Step 2: 核心实现（1天）

**任务2.1**: 实现论文链构建器
```python
# demo_yang_chain.py

class PaperChainBuilder:
    """构建论文引用链"""

    def build_chain(self, start_paper_id: str, length: int = 3) -> List[PaperNode]:
        """
        从起始论文开始，通过引用边构建链

        Args:
            start_paper_id: 起始论文ID
            length: 链长度（3表示3篇论文）

        Returns:
            [Paper1, Paper2, Paper3]
        """
        pass

    def get_connected_entities(self, paper_id: str, max_count: int = 3) -> List[Entity]:
        """
        获取与论文相连的描述实体

        优先级:
        1. 作者 (Author)
        2. 年份 (Year)
        3. 机构 (Institution) 或 期刊 (Venue)
        """
        pass
```

**任务2.2**: 实现问题生成器
```python
class YangChainQuestionGenerator:
    """基于杨逸飞思路的问题生成器"""

    def generate_forward_question(self, paper_chain: List[PaperNode]) -> Question:
        """前向推理问题"""
        pass

    def generate_backward_question(self, paper_chain: List[PaperNode]) -> Question:
        """后向推理问题"""
        pass

    def generate_hop_question(self, paper_chain: List[PaperNode]) -> Question:
        """跳跃推理问题"""
        pass
```

**输出**: `demo_yang_chain.py`（可运行脚本）

---

### Step 3: 测试验证（半天）

**任务3.1**: 运行生成测试
```bash
python demo_yang_chain.py \
    --start-paper paper_123 \
    --chain-length 3 \
    --question-count 10 \
    --output output/yang_chain_demo/
```

**任务3.2**: 人工检查问题质量
```
检查清单:
□ 问题是否有唯一答案？
□ 问题是否通顺自然？
□ 推理链是否合理？
□ 相比V3模板是否有改进？
```

**输出**:
- 生成的问题文件
- 测试报告 `docs/YANG_CHAIN_TEST_REPORT.md`

---

### Step 4: 对比分析（半天）

**任务4.1**: 与V3模板方式对比

| 维度 | V3模板A | 杨逸飞链式 |
|------|---------|-----------|
| 问题示例 | ? | ? |
| 答案唯一性 | ? | ? |
| 问题复杂度 | ? | ? |
| 自然度 | ? | ? |
| 生成成功率 | ? | ? |

**任务4.2**: 撰写试验结论

```
结论模板:
1. 哪些方面比V3好？
2. 哪些方面不如V3？
3. 是否值得继续投入？
4. 下一步建议？
```

**输出**: `docs/YANG_CHAIN_CONCLUSION.md`

---

## 四、时间安排

```
Day 1 (今天)
├── 上午: 数据准备（选3篇论文）
└── 下午: 实现PaperChainBuilder

Day 2
├── 上午: 实现QuestionGenerator
├── 下午: 测试运行，生成问题
└── 晚上: 人工检查问题质量

Day 3
├── 上午: 与V3对比分析
└── 下午: 撰写结论，决定是否继续
```

---

## 五、验收标准

### 5.1 必须完成（MVP）

- [ ] 能成功构建3篇论文的引用链
- [ ] 能生成至少5个有效问题
- [ ] 每个问题有唯一答案
- [ ] 文档记录完整

### 5.2 加分项

- [ ] 问题质量明显优于V3
- [ ] 实现回退机制（某论文无引用时自动换）
- [ ] 支持4-5个论文节点的扩展
- [ ] 生成问题多样性高

### 5.3 失败标准（考虑放弃）

- [ ] 3篇论文链构建失败率 > 50%
- [ ] 问题答案不唯一（多解或无解）
- [ ] 问题质量明显差于V3

---

## 六、风险评估

| 风险 | 概率 | 影响 | 应对策略 |
|------|------|------|---------|
| KG中引用关系数据不足 | 中 | 高 | 提前统计，如不足改用其他边类型 |
| 问题答案不唯一 | 中 | 高 | 增加描述实体数量或约束条件 |
| 实现复杂度超预期 | 低 | 中 | 继续简化（去掉回退、段落理解） |
| 效果不如V3 | 中 | 高 | 记录原因，转向优化V3模板 |

---

## 七、下一步决策点

试验结束后，根据结果选择：

**方案A**: 试验成功，继续完善
- 扩展到10个论文节点
- 实现回退机制
- 引入引用段落理解
- 合并到主分支

**方案B**: 试验失败，回到V3优化
- 分析失败原因
- 吸取杨逸飞方案的合理部分改进V3
- 废弃本分支

**方案C**: 部分成功，折中方案
- 保留链式思想
- 与V3模板结合
- 形成混合方案

---

## 八、参考文档

- `docs/CONVERSATION_LOG_20260204.md` - 杨逸飞思路完整记录
- `demo_fixed_rule.py` - 固定规则Demo（参考代码结构）
- `browsecomp_v3/graph/traversal.py` - 图遍历实现（可复用）

---

**计划制定**: 2026-02-04
**执行负责人**: 用户
**技术支持**: AI Assistant

# Browsecomp 推理链模板 (Reasoning Chain Templates)

本文档将 Browsecomp 的 79 个复杂学术问答谜题抽象为 7 个通用的**推理链模板**，每个模板使用团队定义的图谱 Schema 来表示。

> **相关文档**: 参见 [节点选择规则表](./节点选择规则表.md) 了解如何将自然语言约束映射到知识图谱节点和边。

---

## 图谱 Schema 概述

### 节点类型 (Node Types)

基于QandA项目的实际Schema，系统只使用以下5种节点类型：

| 节点类型 | 描述 | 说明 |
|----------|------|------|
| **Paper** | 论文本体 | 包含学术论文、学位论文等 |
| **Author** | 作者/研究者 | 学者、研究人员 |
| **Institution** | 机构 | 大学、研究机构、医院、公司等 |
| **Venue** | 期刊/会议 | 发表渠道（期刊Journal和会议Conference统一为Venue） |
| **Entity** | 实体 | 通用实体节点，包含：人物、方法、技术、事件、奖项、组织等 |

**重要说明**：
- Journal和Conference不是独立节点类型，统一使用`Venue`
- 独立人物（非Author）、事件、奖项等都用`Entity`表示，通过`type`属性区分

### 边类型 (Edge Types)

基于QandA项目的实际Schema，系统只使用以下5种边类型：

| 边类型 | 方向 | 描述 | 备注 |
|--------|------|------|------|
| **HAS_AUTHOR** | Paper → Author | 论文的作者关系 | 可反向遍历 |
| **AFFILIATED_WITH** | Author → Institution | 作者的机构隶属 | - |
| **PUBLISHED_IN** | Paper → Venue | 论文发表的期刊/会议 | - |
| **MENTIONS** | Paper → Entity | 论文提及的实体 | 包含人物、技术、事件等 |
| **CITES** | Paper → Paper | 论文引用关系 | 可反向遍历查找引用者 |

**重要说明**：
- 合作关系不用独立的边，通过 `Author ← HAS_AUTHOR ← Paper → HAS_AUTHOR → Author` 路径表达
- 致谢关系通过 `Paper → MENTIONS → Entity(type: person)` 表达
- 所有边都支持反向遍历（使用`reverse direction`）

---

## 模板 A: 论文-作者-机构链 (Paper-Author-Institution Chain)

### 描述
解决通过论文特征（发表时间、标题词数、引用数、章节结构）查找作者及其所属机构的查询，是出现频率最高的推理模式（约30%）。

### 推理链 (伪代码)

```
起始节点: Paper
    [过滤条件]
        publication_year BETWEEN X AND Y
        title_word_count = N
        reference_count = M
        author_count = K

    → HAS_AUTHOR → Author
        [过滤条件]
            author_order = 1st/2nd/3rd
            (OR) birth_date BETWEEN X AND Y
            (OR) has_specific_achievement (存储在Author属性中)

        → AFFILIATED_WITH → Institution
            [过滤条件]
                founding_date < YEAR
                (OR) is_one_of_oldest_universities
                (OR) establishment_date BETWEEN X AND Y

    → [查找合作者] HAS_AUTHOR → Author2
        → HAS_AUTHOR(reverse) → Paper_previous
            [验证条件]
                Paper_previous.publication_year = 1994
                Paper_previous 也有 HAS_AUTHOR → Author3 (第一篇论文的另一作者)
```

**说明**：合作关系通过共同论文表达，不使用`has_coauthor_with`边。

### 复杂约束组合示例

```
约束组合 1 (来自 Browsecomp #1):
  (Paper.publication_year < 2010)
  AND (Paper.author_count = 5)
  AND (Paper.title_word_count = 8)
  AND (Paper.reference_count = 27)
  AND (
    EXISTS Author IN Paper.authors WHERE
    Author.name = Country.name
  )
  AND (
    COUNT(Author.AFFILIATED_WITH) >= 3
    WHERE Author.AFFILIATED_WITH = SameInstitution
  )
  AND (
    EXISTS Author1, Author2 IN Paper.authors WHERE
    EXISTS Paper_shared WHERE
    Paper_shared HAS_AUTHOR Author1 AND Paper_shared HAS_AUTHOR Author2
    AND Paper_shared.publication_year = 1994
  )

约束组合 2 (来自 Browsecomp #2):
  (Paper.publication_year BETWEEN 2015 AND 2020)
  AND (Paper.author_count = 2)
  AND (
    FORALL Author IN Paper.authors:
    Author.AFFILIATED_WITH.Institution.is_one_of_oldest_universities = TRUE
  )
  AND (
    Paper.contains_disclosure_statement = TRUE
    AND Paper.disclosure_mentions_initials = ["AF", "AP"]
  )
```

### 覆盖的谜题编号
Browsecomp #1, #2, #7, #9, #10, #11, #14, #15, #16, #17, #19, #20, #21, #22, #23, #24, #25, #26, #29, #31, #32, #33, #34, #37, #39, #40, #41, #46, #47, #50, #53, #54, #57, #65, #66, #67, #68, #69, #70

---

## 模板 B: 人物-学术轨迹链 (Person-Academic-Path Chain)

### 描述
通过人物的学术背景、教育经历、获奖记录、职业时间线来识别特定研究者身份的查询模式（约22%）。

### 推理链 (伪代码)

```
起始节点: Author (目标人物)
    [过滤条件]
        phd_year = YEAR
        (OR) elected_fellow BETWEEN year1 AND year2
        (OR) award_year = YEAR (存储在Author属性中)
        (OR) current_position = POSITION (存储在Author属性中)

    → HAS_AUTHOR(reverse) → Paper (博士论文/代表作)
        [过滤条件]
            publication_year BETWEEN X AND Y
            title CONTAINS "disabilities"
            (OR) topic = SPECIFIC_TOPIC

    → AFFILIATED_WITH → Institution (当前/历史机构)
        [过滤条件]
            founding_date BETWEEN X AND Y
            (OR) institution_type = "liberal_arts_and_sciences"

    → [编辑角色 - 通过Author属性或Paper关联] 
        Author.editor_of_venue (存储在Author属性)
        (OR) HAS_AUTHOR(reverse) → Paper_editorial → PUBLISHED_IN → Venue
            [过滤条件]
                Venue.focus = "teaching_practice"
                first_issue_publication BETWEEN X AND Y

    → [查找合作者] HAS_AUTHOR(reverse) → Paper_collab
        → HAS_AUTHOR → Author2 (合作者)
            [验证条件]
                Paper_collab.publication_year = award_year
```

**说明**：
- 编辑关系存储在Author属性中，或通过Paper→Venue路径推断
- 合作关系通过共同Paper表达，不使用`has_coauthor_with`边

### 复杂约束组合示例

```
约束组合 1 (来自 Browsecomp #4):
  (Author.phd_year = 1983)
  AND (Author.ams_fellow_year BETWEEN 2005 AND 2020, exclusive)
  AND (
    EXISTS Paper, AuthorB, AuthorC WHERE
    Paper HAS_AUTHOR Author AND Paper HAS_AUTHOR AuthorB AND Paper HAS_AUTHOR AuthorC
    AND Paper.publication_year BETWEEN 1990 AND 2005
  )
  AND (
    AuthorB.award = "Rollo Davidson Prize"
    AND AuthorB.award_year BETWEEN 1990 AND 2005, exclusive
  )
  AND (
    EXISTS PaperC WHERE
    PaperC HAS_AUTHOR AuthorC
    AND PaperC.publication_year BETWEEN 1990 AND 1999
    AND PaperC.title ENDS_WITH "Line"
  )

约束组合 2 (来自 Browsecomp #3):
  (Author.phd_year = 6th_year)
  AND (Author.fellowship_topic = "vocal disabilities")
  AND (Author.fellowship_year BETWEEN 2010 AND 2020)
  AND (
    Author.current_position.type = "faculty"
    AND Author.current_affiliation.type = "liberal_arts_and_sciences"
  )
  AND (
    EXISTS Venue WHERE
    Author.editor_of = Venue (存储在Author属性中)
    AND Venue.focus = "improving_teaching_practice"
  )
  AND (
    EXISTS Paper_report WHERE
    Paper_report PUBLISHED_IN Venue
    AND Paper_report.publication_year BETWEEN 2015 AND 2023
    AND Paper_report.volume = "first_issue"
    AND Paper_report.topic = "collaboration_restriction"
  )
```

### 覆盖的谜题编号
Browsecomp #3, #4, #6, #16, #18, #20, #21, #22, #23, #24, #25, #26, #27, #28, #30, #31, #32, #33, #35, #36, #44

---

## 模板 C: 论文引用网络链 (Citation-Network Chain)

### 描述
通过引用关系、参考文献列表、共同引用模式来查找目标论文的查询模式（约15%）。

### 推理链 (伪代码)

```
起始节点: Paper (目标论文)
    [过滤条件]
        publication_year BETWEEN X AND Y

    → CITES → Paper_cited (被引论文)
        [过滤条件]
            publication_year BETWEEN year1 AND year2
            author_count = N
            (OR) title CONTAINS keyword

    ← CITES(reverse direction) ← Paper_citing (引用该论文的论文)
        [过滤条件]
            reference_number = N
            (OR) cited_position = "first_reference"

    → HAS_AUTHOR → Author
        → HAS_AUTHOR(reverse) → Paper_other (作者的其他论文)
            [验证条件]
                Paper_other CITES Paper_cited (共同引用)
```

**说明**：反向引用使用`CITES(reverse direction)`表达，不使用`cited_by`边
            [过滤条件]
                common_citation EXISTS
```

### 复杂约束组合示例

```
约束组合 1 (来自 Browsecomp #8):
  (Paper.topic = "19th_century_African_scholar")
  AND (
    Paper HAS_AUTHOR Author
    AND Paper MENTIONS Entity(type: person, name: scholar_name)
    AND Author.country = Entity.country
  )
  AND (
    Paper.proposes_resource_sharing_model = TRUE
    AND EXISTS Entity(type: country) WHERE
    Entity.area BETWEEN 1000000 AND 1300000  # sq km
    AND Entity.has_similar_sharing_pattern = TRUE
  )

约束组合 2 (来自 Browsecomp #3 in 科普+论文):
  (Paper.sample_size BETWEEN 150 AND 400)
  AND (Paper.author_count = 3)
  AND (
    EXISTS Institution WHERE
    Paper HAS_AUTHOR Author AND Author AFFILIATED_WITH Institution
    AND Institution.founding_year BETWEEN 1975 AND 2000
  )
  AND (
    EXISTS Paper_reference WHERE
    Paper CITES Paper_reference
    AND Paper_reference.publication_year BETWEEN 1990 AND 2015
    AND Paper_reference.topic = "interpersonal_bonding_dynamics"
  )
```

### 覆盖的谜题编号
Browsecomp #8, #42, #54, #72, #73, #74, #76, #78

---

## 模板 D: 多论文合作网络链 (Collaboration-Network Chain)

### 描述
通过多篇论文之间的共同作者关系、作者排列顺序变化来识别特定论文的查询模式（约10%）。

### 推理链 (伪代码)

```
起始节点: Paper_set (论文集合)
    [过滤条件]
        publication_years = [year1, year2, year3, ...]

    → HAS_AUTHOR → Author_common (共同作者)
        [过滤条件]
            EXISTS_IN_ALL_PAPERS = TRUE
            (OR) author_position_consistent = [1st, 1st, 1st]

    → HAS_AUTHOR(reverse) → Paper_target (目标论文)
        → HAS_AUTHOR → Author_others (其他合作者)
            [过滤条件]
                author_order = [PersonA, PersonB, PersonC]
                is_first_publication = TRUE
```

**说明**：所有合作关系通过Paper作为中介，不使用`has_coauthor_with`边

### 复杂约束组合示例

```
约束组合 1 (来自 Browsecomp #12):
  (
    EXISTS Paper1, Paper2, Paper3 WHERE
    Paper1.publication_year BETWEEN 2006 AND 2011
    AND Paper2.publication_year BETWEEN 2006 AND 2011
    AND Paper3.publication_year BETWEEN 2006 AND 2011
  )
  AND (
    EXISTS Author1, Author2 WHERE
    Paper1 HAS_AUTHOR Author1 AND Paper2 HAS_AUTHOR Author1 AND Paper3 HAS_AUTHOR Author1
    AND Paper1 HAS_AUTHOR Author2 AND Paper2 HAS_AUTHOR Author2 AND Paper3 HAS_AUTHOR Author2
  )
  AND (
    Author1 AFFILIATED_WITH Institution1
    AND Institution1.founding_year BETWEEN 1955 AND 1960
    AND Author1.current_status = "faculty"
  )
  AND (
    Author2 AFFILIATED_WITH Institution2
    AND Institution2.founding_year BETWEEN 1945 AND 1950
    AND Author2.previous_employer.founding_year BETWEEN 1840 AND 1850
    AND Author2.previous_employer.focus = "traffic_operations_safety"
  )
  AND (
    EXISTS Author3 WHERE
    Paper1 HAS_AUTHOR Author3 AND Paper2 HAS_AUTHOR Author3 AND Paper3 HAS_AUTHOR Author3
    AND Paper1.is_first_published = TRUE
    AND Paper1.author_order = [Author2, Author1, Author3]
  )

约束组合 2 (来自 Browsecomp #7):
  (
    EXISTS Paper2015, Paper2017 WHERE
    Paper2015.publication_year = 2015
    AND Paper2017.publication_year = 2017
    AND Paper2015.authors[0] = Paper2017.authors[0]
    AND Paper2015.authors[2] = Paper2017.authors[2]
  )
  AND (
    EXISTS Author WHERE
    Author = Paper2015.authors[2]
    AND Author.birth_year BETWEEN 1933 AND 1935
    AND Author.birth_place.name_derived_from = "fire_destroyed_woodland"
  )
  AND (
    EXISTS Paper1998 WHERE
    Paper2015 MENTIONS Entity(type: person, acknowledged: Paper1998.authors[2])
    AND Paper1998.publication_year = 1998
  )
```

### 覆盖的谜题编号
Browsecomp #7, #12, #38, #43, #45, #49, #55, #59, #60, #61, #71, #72, #75

---

## 模板 E: 活动-参与-成果链 (Event-Participation Chain)

### 描述
通过会议演讲、研讨会参与、机构历史特征等事件来查找相关论文或人物的查询模式（约16%）。

### 推理链 (伪代码)

```
起始节点: Author (演讲者/参与者)
    [过滤条件]
        gave_talk_at_event (存储在Author属性或相关Paper的MENTIONS中)

    → MENTIONS(reverse) ← Paper_about_event
        → MENTIONS → Entity(type: event)
            [过滤条件]
                event_year = YEAR
                event_location = CITY/COUNTRY
                event_type = "conference" / "symposium" / "talk"

    → AFFILIATED_WITH → Institution
        [过滤条件]
            founding_date BETWEEN X AND Y
            (OR) undergraduate_admission_2020 = NUMBER

    → HAS_AUTHOR(reverse) → Paper (研究论文)
        [过滤条件]
            publication_year BETWEEN X AND Y
        → HAS_AUTHOR → Author2 (合作者)
            [验证条件]
                Author2.publication_count_2020 = 1
```

**说明**：
- 事件用`Entity(type: event)`表达，不使用`EventNode`或`ConferenceNode`
- 演讲者关系通过Author属性或`Paper → MENTIONS → Entity(event)`关联

### 复杂约束组合示例

```
约束组合 1 (来自 Browsecomp #13):
  (
    EXISTS Entity(type: event, year: 2017) WHERE
    Entity.visited_institution.undergrad_admission_2020 = 3695
    AND Author.gave_talk_count = 2
    AND Entity.talk_topic = "defensive_mechanism_against_invaders"
  )
  AND (
    EXISTS Entity(type: symposium, year: 2022) WHERE
    Entity.speaker = Author
    AND Entity.location = previous_event.location
  )
  AND (
    Author AFFILIATED_WITH Institution
    AND Institution.founding_year BETWEEN 1950 AND 1990
  )
  AND (
    EXISTS Paper WHERE
    Paper HAS_AUTHOR Author AND Paper HAS_AUTHOR Author2
    AND Author2.publication_count_2020 = 1
    AND Paper.publication_year BETWEEN 2010 AND 2015
    AND Paper.title CONTAINS punctuation_mark
  )

约束组合 2 (来自 Browsecomp #1 in 询问人物信息):
  (
    EXISTS Author WHERE
    Author.supported_proposal = "new_rail_system"
    AND EXISTS Entity(type: committee) WHERE
    Entity.investigated = Author.supported_proposal
    AND Entity.formation_year BETWEEN 2000 AND 2023
  )
  AND (
    EXISTS Institution WHERE
    Author.bachelor_degree_from = Institution
    AND Institution.charter_year BETWEEN 1850 AND 1895
    AND EXISTS Entity(type: person, role: actor) WHERE
    Entity.alma_mater = Institution
    AND Entity.starred_in = "comedy_show_1970s"
    AND Entity.role = "grumpy_patient"
  )
```

### 覆盖的谜题编号
Browsecomp #1, #13, #17, #18, #35, #52, #56, #58, #62, #63, #64

---

## 模板 F: 技术内容-实体链 (Technical-Content Chain)

### 描述
通过具体技术规格、实验数据、方法学特征、材料属性等来找论文的查询模式（约5%）。

### 推理链 (伪代码)

```
起始节点: Paper
    [过滤条件]
        publication_year BETWEEN X AND Y

    → MENTIONS → Entity(type: technology/method/material)
        [过滤条件]
            entity_type = "coolant" / "alloy" / "compound"
            (OR) technical_parameter_value BETWEEN X AND Y
            (OR) specification = "annealing_temperature > 300°C"

    → HAS_AUTHOR → Author
        → HAS_AUTHOR(reverse) → Paper_other (作者的其他论文)
            [验证条件]
                Paper_other MENTIONS SAME Entity
```

### 复杂约束组合示例

```
约束组合 1 (来自 Browsecomp #1 in 材料):
  (Paper.publication_year BETWEEN 2010 AND 2020)
  AND (
    EXISTS Entity1 WHERE
    Paper MENTIONS Entity1
    AND Entity1.type = "coolant"
    AND Entity1.property = "sustainable_alternative"
  )
  AND (
    EXISTS Entity2 WHERE
    Paper MENTIONS Entity2
    AND Entity2.type = "alloy"
    AND Entity2.annealing_temperature BETWEEN 300 AND 800  # °C
    AND Entity2.elastic_modulus BETWEEN 10000 AND 18000  # ksi
  )
  AND (
    EXISTS Institution WHERE
    Paper.submitted_to = Institution
    AND Institution.student_growth_period = "1850s"
    AND Institution.student_growth = "rapid"
  )
  AND (
    EXISTS Author WHERE
    Paper HAS_AUTHOR Author
    AND Author.bsc_year BETWEEN 2005 AND 2013
  )

约束组合 2 (来自 Browsecomp #10 in 科普+论文论文相关信息):
  (
    EXISTS Author WHERE
    Author AFFILIATED_WITH Institution
    AND Institution.undergrad_applicants_2022 = 23819
    AND Author.research_topic = "iron_dependent_cell_death"
  )
  AND (
    EXISTS Entity WHERE
    Entity.type = "cell_death"
    AND Entity.dependent_on = "iron"
    AND Entity.distinct_from = ["necrosis", "apoptosis"]
  )
  AND (
    Author.undergraduate_institution.type = "all_women_university"
    AND Author.undergraduate_institution.location = "Asian_country"
  )
  AND (
    COUNT(Paper WHERE
      Paper HAS_AUTHOR Author
      AND Paper.title CONTAINS Entity.name
      AND Paper.publication_year < 2023
      AND Paper.indexed_in = "PubMed"
    )
  )
```

### 覆盖的谜题编号
Browsecomp #77, #79(材料), #67(科普+论文论文相关信息), #69(科普+论文论文相关信息)

---

## 模板 G: 致谢-人际关系统 (Acknowledgment-Relation Chain)

### 描述
通过论文致谢部分的人际关系、感谢对象来查找特定信息的查询模式（约2%）。

### 推理链 (伪代码)

```
起始节点: Paper (论文/学位论文)
    [过滤条件]
        publication_year BETWEEN X AND Y
        document_type = "thesis" / "dissertation"

    → MENTIONS → Entity(type: person, role: acknowledged)
        [过滤条件]
            relationship_type = "spouse" / "child" / "sibling"
            (OR) specific_phrase = "infinite faith and love"
            (OR) entity_subtype = "restaurant" (acknowledged in thesis)

    → HAS_AUTHOR → Author (论文作者)
        [验证条件]
            author.affiliation = SPECIFIC_INSTITUTION
        → HAS_AUTHOR(reverse) → Paper_other (合著论文)
            [验证条件]
                Paper_other.publication_year BETWEEN X AND Y
```

**说明**：
- 致谢关系通过`Paper → MENTIONS → Entity(type: person, role: acknowledged)`表达
- 被致谢的人物、餐厅等都用Entity表示

### 复杂约束组合示例

```
约束组合 1 (来自 Browsecomp #5 in 询问论文标题):
  (
    EXISTS Paper(type: thesis) WHERE
    Paper.submission_year BETWEEN 2010 AND 2013
    AND Paper.submitted_to = "University of California"
  )
  AND (
    EXISTS Author WHERE
    Paper HAS_AUTHOR Author
    AND Author.btech_from = "IIT BHU"
    AND Author.master_from = "UCLA"
  )
  AND (
    EXISTS Paper_other WHERE
    Paper_other HAS_AUTHOR Author
    AND Paper_other.publication_year BETWEEN 2020 AND 2022
  )
  AND (
    EXISTS Entity(type: organization, subtype: restaurant) WHERE
    Paper MENTIONS Entity
    AND Entity.founding_year BETWEEN 1980 AND 1988
  )

约束组合 2 (来自 Browsecomp #7 in 询问人物信息):
  (
    EXISTS Paper(type: thesis) WHERE
    Paper.submission_year = 2018
    AND Paper.submitted_to = "University of Rhode Island"
  )
  AND (
    EXISTS Author WHERE
    Paper HAS_AUTHOR Author
    AND Author.major_professor.phd_from = "MIT"
  )
  AND (
    EXISTS Paper_other WHERE
    Paper_other HAS_AUTHOR Author
    AND Paper_other.published_by = "ASME"
    AND Paper_other.publication_year = 2020
  )
  AND (
    EXISTS Entity(type: person, role: acknowledged) WHERE
    Paper MENTIONS Entity
    AND Entity.relationship = "then-wife"
    AND Entity.thanked_for = "infinite faith and love"
  )

约束组合 3 (来自 Browsecomp #12 in 询问人物信息):
  (
    EXISTS Paper(type: dissertation) WHERE
    Paper.submission_year BETWEEN 2014 AND 2017
    AND Paper.submitted_to = "Carnegie Mellon University"
  )
  AND (
    EXISTS Author WHERE
    Paper HAS_AUTHOR Author
    AND Author.arxiv_submission_year BETWEEN 2012 AND 2014
    AND Author.second_submission_year BETWEEN 2014 AND 2016
    AND Author.siebel_scholar_year BETWEEN 2013 AND 2017
    AND Author.degree_from = "University of San Diego"
    AND Author.company_founding_year BETWEEN 2015 AND 2019
  )
  AND (
    EXISTS Entity(type: person, role: acknowledged_child) WHERE
    Paper MENTIONS Entity
    AND Entity.relationship = "author's_child"
  )
```

### 覆盖的谜题编号
Browsecomp #5, #7, #9, #12, #22, #25, #27, #29, #48, #51, #66, #67

---

## 重复覆盖说明

以下谜题被多个模板覆盖，已指定主模板：

| 谜题编号 | 覆盖的模板 | 主模板 | 理由 |
|----------|------------|--------|------|
| #1 | 模板A, 模板E | 模板A | 论文-作者-机构是主要推理模式 |
| #7 | 模板A, 模板D, 模板G | 模板D | 多论文合作是主要模式 |
| #9 | 模板A, 模板G | 模板G | 致谢关系是主要模式 |
| #12 | 模板D, 模板G | 模板D | 合作网络是主要模式 |

---

## 模板与谜题映射表

| 模板 | 覆盖数量 | 涵盖的谜题编号 | 核心推理模式 |
|------|----------|----------------|--------------|
| **模板 A: 论文-作者-机构** | 39 | #1, #2, #7, #9, #10, #11, #14, #15, #16, #17, #19, #20, #21, #22, #23, #24, #25, #26, #29, #31, #32, #33, #34, #37, #39, #40, #41, #46, #47, #50, #53, #54, #57, #65, #66, #67, #68, #69, #70 | Paper → Author → Institution |
| **模板 B: 人物-学术轨迹** | 21 | #3, #4, #6, #16, #18, #20, #21, #22, #23, #24, #25, #26, #27, #28, #30, #31, #32, #33, #35, #36, #44 | Person → Education → Award → Position |
| **模板 C: 引用网络** | 8 | #8, #42, #54, #72, #73, #74, #76, #78 | Paper ← cites ← Paper |
| **模板 D: 合作网络** | 13 | #7, #12, #38, #43, #45, #49, #55, #59, #60, #61, #71, #72, #75 | Multi-Paper → Shared Authors |
| **模板 E: 活动-参与** | 11 | #1, #13, #17, #18, #35, #52, #56, #58, #62, #63, #64 | Event → Speaker → Affiliation → Paper |
| **模板 F: 技术内容** | 4 | #77, #79, #67, #69 | Paper → Technical Entity → Parameters |
| **模板 G: 致谢-关系** | 12 | #5, #7, #9, #12, #22, #25, #27, #29, #48, #51, #66, #67 | Paper → Acknowledgment → Person |

**覆盖率变化**: 24.1% (19/79) → 100% (79/79)

---

## 重要说明：如何用5种边表达复杂关系

QandA项目只使用5种边（HAS_AUTHOR, AFFILIATED_WITH, PUBLISHED_IN, MENTIONS, CITES），但可以表达Browsecomp问题中的所有复杂关系。

### 合作关系 (Co-authorship)

**❌ 错误方式**: `Author → has_coauthor_with → Author`

**✅ 正确方式**: 
```
Author1 → HAS_AUTHOR(reverse) → Paper_shared → HAS_AUTHOR → Author2
```

**示例**：查找Author1和Author2在1994年的合作
```
Author1 ← HAS_AUTHOR ← Paper(year=1994) → HAS_AUTHOR → Author2
```

### 致谢关系 (Acknowledgment)

**❌ 错误方式**: `Paper → acknowledges → Person`

**✅ 正确方式**:
```
Paper → MENTIONS → Entity(type: person, role: acknowledged)
```

**示例**：论文致谢配偶
```
Paper → MENTIONS → Entity(type: person, relationship: "spouse", 
                          thanked_for: "infinite faith and love")
```

### 反向引用 (Reverse Citation)

**❌ 错误方式**: `Paper ← cited_by ← Paper`

**✅ 正确方式**:
```
Paper ← CITES(reverse direction) ← Paper_citing
```

**说明**：QandA的`reverse_adjacency`支持反向遍历所有边。

### 活动参与 (Event Participation)

**❌ 错误方式**: `Event → has_speaker → Author`

**✅ 正确方式**:
```
# 方式1：存储在Author属性中
Author.events_participated = [event1, event2, ...]

# 方式2：通过Entity表达
Paper → MENTIONS → Entity(type: event, speaker: Author_name, year: 2017)
```

### 编辑角色 (Editorial Role)

**❌ 错误方式**: `Author → has_editor_role → Journal`

**✅ 正确方式**:
```
# 方式1：存储在Author属性中
Author.editor_of_venues = ["Journal Name", ...]

# 方式2：通过Paper推断
Paper_editorial → HAS_AUTHOR → Author
Paper_editorial → PUBLISHED_IN → Venue
(推断: Author可能是Venue的编辑)
```

### 独立人物 (Non-Author Person)

**❌ 错误方式**: 使用独立的`PersonNode`

**✅ 正确方式**:
```
# 用Entity表达
Entity(type: person, name: "John Doe", role: "actor/historical_figure/...")
```

**示例**：19世纪学者
```
Paper → MENTIONS → Entity(type: person, era: "19th_century", 
                          role: "scholar", country: "...")
```

### 事件和会议 (Events and Conferences)

**❌ 错误方式**: 使用`EventNode`, `ConferenceNode`

**✅ 正确方式**:
```
# 会议/期刊：用Venue
Paper → PUBLISHED_IN → Venue(type: "conference", name: "ICML 2023")

# 演讲/活动：用Entity
Paper → MENTIONS → Entity(type: event, name: "TED Talk 2020")
```

### 组织机构 (Organizations beyond Institutions)

**❌ 错误方式**: 为餐厅、诊所等创建特殊节点

**✅ 正确方式**:
```
# 用Entity表达
Entity(type: organization, subtype: "restaurant/clinic/...", 
       name: "...", founding_year: ...)
```

---

## 关键约束类型说明

### 时间约束 (Temporal Constraints)
- **时间段**: `BETWEEN x AND y (inclusive/exclusive)`
- **相对时间**: `well into the 20th century`, `late 2000s`
- **事件顺序**: `paper_published AFTER conference_attended`

### 计数约束 (Count Constraints)
- **精确计数**: `author_count = 5`, `reference_count = 27`
- **范围计数**: `sample_size BETWEEN 150 AND 400`
- **存在性计数**: `EXISTS_IN_ALL_PAPERS`, `MORE_THAN 3 authors`

### 属性匹配约束 (Attribute Matching)
- **字符串匹配**: `title ENDS_WITH "problems"`, `name = Country.name`
- **包含关系**: `title CONTAINS "Intervention"`, `topic INCLUDES "vocal disabilities"`
- **精确短语**: `specific_phrase = "infinite faith and love"`

### 逻辑组合约束 (Logical Combinations)
- **AND 组合**: 多个条件必须同时满足
- **OR 组合**: 任一条件满足即可
- **嵌套逻辑**: `(A AND B) OR (C AND D)`
- **存在量词**: `EXISTS`, `FORALL`, `COUNT`

---

## 使用指南

### 如何应用模板

1. **识别问题类型**: 根据 Browsecomp 谜题的特征，判断属于哪个模板
2. **提取约束条件**: 将自然语言描述转换为 Schema 约束
3. **构建推理链**: 按照模板的伪代码结构构建查询路径
4. **验证约束**: 检查所有约束是否被正确表示

### 示例应用

**Browsecomp #1**:
```
应用模板 A: 论文-作者-机构链

起始: Paper (publication_year < 2010, author_count = 5)
  → HAS_AUTHOR → Author (name 匹配国家名)
  → AFFILIATED_WITH → Institution (3位作者同一机构)
  → HAS_AUTHOR → Author2
      → HAS_AUTHOR(reverse) → Paper1994 (1994年合作)
  → Author.achievement (1990年创立诊所, 2019年演讲)
  → Paper.title (8个词)
  → Paper.reference_count (27条)
```

---

## 附录: 未覆盖的特殊模式

少数谜题涉及更复杂的组合或特殊领域知识，可能需要跨模板推理:

- **历史文献链** (#6): 涉及19世纪作家和文献
- **食品文化链** (#23): 食品专栏作家与心理健康研究
- **游戏媒体链** (#13 询问人物信息): 电子游戏与学术文献的交叉

这些可以视为模板的组合应用或扩展变体。
